<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Documents - MAGERWA</title>
</head>
<body>
    <div layout:fragment="content">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Documents</h1>
            <a href="/documents/upload" class="btn btn-primary">Upload Document</a>
        </div>

        <div th:if="${section != null}" class="alert alert-info">
            Showing documents from section: <strong th:text="${section.name}">Section Name</strong>
        </div>

        <div th:if="${documents != null and !documents.empty}">
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Description</th>
                            <th>Section</th>
                            <th>Uploaded By</th>
                            <th>Upload Date</th>
                            <th>File Size</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="doc : ${documents}">
                            <td>
                                <a th:href="@{/documents/{id}(id=${doc.id})}" th:text="${doc.title}">Document Title</a>
                            </td>
                            <td th:text="${doc.description}">Description</td>
                            <td th:text="${doc.section.name}">Section</td>
                            <td th:text="${doc.uploadedBy.fullName}">User Name</td>
                            <td th:text="${#temporals.format(doc.uploadDate, 'dd MMM yyyy HH:mm')}">Upload Date</td>
                            <td th:text="${#numbers.formatDecimal(doc.fileSize/1024.0, 1, 'COMMA', 1, 'POINT')} + ' KB'">File Size</td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    <a th:href="@{/documents/{id}/download(id=${doc.id})}" class="btn btn-outline-primary">Download</a>
                                    <button type="button" class="btn btn-outline-warning" onclick="archiveDocument([[${doc.id}]])">Archive</button>
                                    <button type="button" class="btn btn-outline-danger" onclick="deleteDocument([[${doc.id}]])">Delete</button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div th:if="${documents == null or documents.empty}" class="alert alert-info">
            No documents found. <a href="/documents/upload">Upload your first document</a>.
        </div>

        <!-- Hidden forms for archive/delete actions -->
        <form id="archiveForm" method="post" style="display: none;">
            <input type="hidden" name="action" value="archive">
        </form>
        <form id="deleteForm" method="post" style="display: none;">
            <input type="hidden" name="action" value="delete">
        </form>

        <script>
            function archiveDocument(docId) {
                if (confirm('Are you sure you want to archive this document?')) {
                    const form = document.getElementById('archiveForm');
                    form.action = '/documents/' + docId + '/archive';
                    form.submit();
                }
            }
            
            function deleteDocument(docId) {
                if (confirm('Are you sure you want to delete this document?')) {
                    const form = document.getElementById('deleteForm');
                    form.action = '/documents/' + docId + '/delete';
                    form.submit();
                }
            }
        </script>
    </div>
</body>
</html>